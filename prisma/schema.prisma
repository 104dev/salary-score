datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model SalaryEntry {
  id               String   @id @default(cuid())
  createdAt        DateTime @default(now())

  // Cookie / localStorage と紐づくクライアントID（匿名）
  clientId         String?
  nickname         String?

  age              Int

  // 大分類（営業/ITエンジニア/…）
  jobCategoryCode  String

  // サブカテゴリ（コード値）
  jobSubCategory   String?

  // サブカテゴリ自由入力（Other選択時のみ）
  jobSubCategoryOther String?

  // 年収
  annualIncome     Int

  // 業界分類（後で補正に使う）
  industryCode     String?

  genderCode       String? 

  // 質問フォームの世代（v1,v2…）
  surveyVersion    Int      @default(1)

  // 入力時アンケート
  SurveyResponse   SurveyResponse?

  // 結果スナップショット
  SnapshotResult   SnapshotResult?

  // 高年収理由（結果画面用）
  HighIncomeReason HighIncomeReasonResponse?

  @@index([jobCategoryCode, age])
  @@index([jobCategoryCode, jobSubCategory])
  @@index([industryCode, jobCategoryCode])
}

model SurveyResponse {
  id           String   @id @default(cuid())
  entryId      String   @unique
  createdAt    DateTime @default(now())

  selfAvgGuess Int?
  extraAnswers Json?
　isSatisfied  Boolean?

  SalaryEntry  SalaryEntry @relation(fields: [entryId], references: [id])
}

model SnapshotResult {
  id           String      @id @default(cuid())
  entryId      String      @unique
  createdAt    DateTime    @default(now())

  SalaryEntry  SalaryEntry @relation(fields: [entryId], references: [id])

  score        Int
  zScore       Float
  percentile   Float
  sampleSize   Int
  histogram    Json
  scoreVersion Int         @default(1)
}

model HighIncomeReasonResponse {
  id           String   @id @default(cuid())
  entryId      String   @unique
  createdAt    DateTime @default(now())

  // 例: ["SKILL", "MANAGEMENT", "HIGH_COMP_RANGE"]
  reasonCodes   String[]

  freeText      String?

  SalaryEntry   SalaryEntry @relation(fields: [entryId], references: [id])
}
